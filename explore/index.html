<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qur'an Reflection Viewer</title>
<meta name="keywords" content="Quran, Islamic, Ayah, Tafsir, Reflection, Language">
<meta name="author" content="Zimaam Zayn">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Explore Quran in a way you always yearned for">
<meta property="og:description" content="Dive into each ayat of Quran as never before.">
<meta property="og:image" content="icon.png">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ayah.hs.vc/explore">

<!-- Favicon/Icon -->
<link rel="icon" type="image/png" href="../icon.png">

<!-- Qur'anic Arabic Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Amiri&family=Scheherazade+New:wght@400;600&display=swap" rel="stylesheet">

<style>
  /* Disable text selection */
  body {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }
</style>

<script>
  // Disable Right Click, Copy, Cut, Paste
  document.addEventListener("contextmenu", e => e.preventDefault());
  ["copy","cut","paste"].forEach(ev => document.addEventListener(ev, e => e.preventDefault()));

  // Block Developer Tools
  document.addEventListener("keydown", function (e) {
      if (
          e.key === "F12" ||
          (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
          (e.ctrlKey && e.key === "U")
      ) e.preventDefault();
  });

  (function detectDevTools() {
      setInterval(() => {
          if (window.outerWidth - window.innerWidth > 160 || window.outerHeight - window.innerHeight > 160) {
              console.clear();
              alert("Developer tools detected! Please close them.");
              window.location.reload();
          }
      }, 1000);
  })();

  function blockDebugger() {
      setInterval(() => { debugger; }, 50);
  }
  blockDebugger();
</script>

<style>
  body {
    font-family: "Segoe UI", Roboto, sans-serif;
    background-color: #ffffff;
    margin: 0;
    padding: 0;
    color: #1e3d24;
  }

  a { text-decoration: none; color: inherit; }

  header.site-header {
    background: linear-gradient(135deg, #ffffff, #f4fff7);
    padding: 25px 20px;
    text-align: center;
    border-bottom: 1px solid #d8f3dc;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  header.site-header h1 {
    margin: 0;
    font-size: 2.5rem;
    color: #17653a;
  }

  header.site-header p {
    margin: 5px 0 0 0;
    color: #355e3b;
    font-size: 1rem;
    opacity: 0.85;
  }

  footer.site-footer {
    text-align: center;
    padding: 25px 10px;
    background-color: #f9fdf9;
    color: #2b4d36;
    font-size: 0.9rem;
    border-top: 1px solid #e4f5ea;
  }

  footer.site-footer a {
    color: #2ca35a;
    margin: 0 10px;
    font-weight: 500;
  }

  footer.site-footer a:hover { text-decoration: underline; }

  .container {
    max-width: 800px;
    margin: 30px auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.05);
    padding: 25px;
  }

  h2 { text-align: center; color: #00796b; margin-top: 0; }
  .verse-info { text-align: center; color: #777; margin-bottom: 20px; }

  .arabic-text {
    font-family: "Scheherazade New", "Amiri", "Traditional Arabic", serif;
    font-size: 38px;
    text-align: center;
    margin: 30px 0;
    line-height: 2;
    color: #1a1a1a;
    direction: rtl;
    word-spacing: 4px;
  }

  .section { background: #f9f9f9; border-left: 4px solid; padding: 15px; border-radius: 8px; margin: 15px 0; }
  .transliteration { border-color: #03A9F4; background-color: #E1F5FE; }
  .translation { border-color: #2196F3; background-color: #f1f7ff; }
  .linguistics { border-color: #9C27B0; background-color: #f8f2fb; }
  .context { border-color: #FF9800; background-color: #fff6eb; }
  .reflection { border-color: #4CAF50; background-color: #f2fbf2; }
  .similar { border-color: #FF5722; background-color: #fff2f0; }

  .section h3 { margin-top: 0; }
  .section p { white-space: pre-wrap; }

  .nav-buttons { display: flex; justify-content: space-between; margin-top: 25px; gap: 10px; flex-wrap: wrap; }
  button { padding: 10px 18px; font-size: 15px; background-color: #00796b; color: white; border: none; border-radius: 6px; cursor: pointer; transition: 0.3s; }
  button:hover { background-color: #005f56; }

  #home-btn {
    background: linear-gradient(to right, #4CAF50, #81C784);
    border-radius: 50px;
    padding: 10px 20px;
    font-weight: 600;
    box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
  }
  #home-btn:hover {
    background: linear-gradient(to right, #388E3C, #4CAF50);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(76, 175, 80, 0.4);
  }

  #prev-btn, #next-btn {
    background: linear-gradient(to right, #00796b, #009688);
    border-radius: 50px;
    padding: 10px 20px;
    font-weight: 600;
    box-shadow: 0 4px 8px rgba(0, 121, 107, 0.3);
  }
  #prev-btn:hover, #next-btn:hover {
    background: linear-gradient(to right, #005f56, #00796b);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 121, 107, 0.4);
  }

  .similar a {
    display: inline-block;
    margin: 5px 8px 5px 0;
    padding: 5px 10px;
    background-color: #FF5722;
    color: white;
    border-radius: 5px;
    text-decoration: none;
    transition: 0.3s;
  }
  .similar a:hover { background-color: #e64a19; }

  .goto-verse {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
  }
  .goto-verse input {
    width: 80px;
    padding: 8px 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    text-align: center;
  }
  .goto-verse button {
    padding: 8px 16px;
    background-color: #00796b;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .goto-verse button:hover { background-color: #005f56; }
</style>
</head>
<body>

<header class="site-header" style="padding: 15px 20px;">
  <h1 style="font-size: 1.5rem; margin: 0; color: #17653a;">Ayah Qur‚Äôan Viewer</h1>
  <p style="font-size: 0.85rem; margin: 5px 0 0 0; color: #355e3b; opacity: 0.85;">
    Explore verses with reflection, context, and linguistic insight
  </p>
</header>

<div class="container">
  <h2 id="surah-name">Loading...</h2>
  <div class="verse-info" id="verse-info"></div>
  <div class="arabic-text" id="arabic-text"></div>

  <div class="section transliteration">
    <h3>Transliteration</h3>
    <p id="transliteration"></p>
  </div>

  <div class="section translation">
    <h3>English Translation</h3>
    <p id="translation"></p>
  </div>

  <div class="section linguistics">
    <h3>Linguistic Analysis</h3>
    <p id="linguistic"></p>
  </div>

  <div class="section context">
    <h3>Context of Revelation</h3>
    <p id="context"></p>
  </div>

  <div class="section reflection">
    <h3>Reflections</h3>
    <p id="reflection"></p>
  </div>

  <div class="section similar">
    <h3>Similar Verses</h3>
    <div id="similar-verses"></div>
  </div>

  <div class="nav-buttons">
    <button id="prev-btn">‚Äπ Prev</button>
    <button id="home-btn">üè† Home</button>
    <button id="next-btn">Next ‚Ä∫</button>
  </div>

  <div class="goto-verse">
    <input type="number" id="surah-input" placeholder="Surah #" min="1">
    <input type="number" id="verse-input" placeholder="Verse #" min="1">
    <button id="goto-btn">Go To</button>
  </div>
</div>

<footer class="site-footer">
  <p>Contact us:</p>
  <p>
    <a href="https://t.me/zimaamzayn" target="_blank">Telegram</a> |
    <a href="mailto:zayn123@duck.com">Email</a>
  </p>
  <p>¬© 2025 Ayah Platform ‚Äî All Rights Reserved</p>
</footer>

<script>
let currentSurah = 1;
let currentVerse = 1;

// Function to update the URL based on currentSurah and currentVerse
function updateUrl() {
  // This should only be called *after* currentSurah and currentVerse are set correctly
  history.pushState({ surah: currentSurah, verse: currentVerse }, "", `?surah=${currentSurah}&verse=${currentVerse}`);
}

async function loadVerse(chapter, verse, updateHistory = true) {
  try {
    const response = await fetch(`${chapter}-${verse}.json`);
    if (!response.ok) throw new Error("Verse not found");
    const data = await response.json();

    document.getElementById("surah-name").textContent = data["Surah"];
    document.getElementById("verse-info").textContent = `Verse ${data["Verse"]}`;
    document.getElementById("arabic-text").textContent = data["Arabic Text"];
    document.getElementById("transliteration").textContent = data["Transliteration"] || "‚Äî";
    document.getElementById("translation").textContent = data["English Translation"] || "";
    document.getElementById("linguistic").textContent = data["Linguistic Analysis"] || "";
    document.getElementById("context").textContent = data["Context of Revelation"] || "";
    document.getElementById("reflection").textContent = data["Reflections"] || "";

    // IMPORTANT: Update currentSurah and currentVerse *before* updating the URL
    const parts = data["Verse"].split("-");
    currentSurah = parseInt(parts[0]);
    currentVerse = parseInt(parts[1]);

    // Update URL *after* currentSurah and currentVerse are set, if requested
    if (updateHistory) {
      updateUrl(); // This function uses the updated currentSurah and currentVerse
    }

    const similarDiv = document.getElementById("similar-verses");
    similarDiv.innerHTML = "";
    if (data["Similar Verses"]) {
      data["Similar Verses"].forEach(ref => {
        const a = document.createElement("a");
        a.href = `?surah=${ref.split("-")[0]}&verse=${ref.split("-")[1]}`;
        a.textContent = ref;
        a.onclick = (e) => {
          e.preventDefault();
          const [s, v] = ref.split("-").map(Number);
          // Load the verse and update history for similar verse clicks
          loadVerse(s, v, true);
        };
        similarDiv.appendChild(a);
      });
    }
  } catch (err) {
    console.error(err);
    alert(`Failed to load verse ${chapter}:${verse}. Error: ${err.message}`);
    // Optionally, revert URL if load failed and history was updated
    // if (updateHistory) {
    //    history.pushState({ surah: currentSurah, verse: currentVerse }, "", `?surah=${currentSurah}&verse=${currentVerse}`);
    // }
  }
}

// Handle Back/Forward navigation
window.onpopstate = (event) => {
  console.log("popstate event fired. State:", event.state); // Debug log
  if (event.state && event.state.surah !== undefined && event.state.verse !== undefined) {
    // When back/forward is pressed, load the verse from the state object pushed by pushState
    // Do not push a new state here (updateHistory = false)
    loadVerse(event.state.surah, event.state.verse, false);
  } else {
      // If state is null or incomplete (e.g., going back to a page without state pushed by our script),
      // you might want to reload based on the current URL parameters or load a default.
      // Fallback: try to parse the current URL
      const urlParams = new URLSearchParams(window.location.search);
      const surahParam = parseInt(urlParams.get("surah"));
      const verseParam = parseInt(urlParams.get("verse"));
      if (!isNaN(surahParam) && !isNaN(verseParam)) {
          loadVerse(surahParam, verseParam, false); // Load based on URL, don't push state
      } else {
          loadVerse(1, 1, false); // Default fallback, don't push state
      }
  }
};

// Navigation buttons - Always update history when these are clicked
document.getElementById("prev-btn").onclick = async () => {
  if (currentVerse > 1) currentVerse--;
  else if (currentSurah > 1) { currentSurah--; currentVerse = 1; }
  await loadVerse(currentSurah, currentVerse, true); // Update history
};

document.getElementById("next-btn").onclick = async () => {
  let nextSurah = currentSurah;
  let nextVerse = currentVerse + 1;
  try {
    const res = await fetch(`${nextSurah}-${nextVerse}.json`);
    if (!res.ok) {
         // If next verse doesn't exist in current surah, go to first verse of next surah
         nextSurah++;
         nextVerse = 1;
         // Optional: Check if nextSurah itself is valid (e.g., <= 114)
         // if (nextSurah > 114) { /* handle end of Quran */ }
    }
  } catch {
      // If fetch fails, assume we need to go to next surah
      nextSurah++;
      nextVerse = 1;
      // Optional: Check if nextSurah itself is valid (e.g., <= 114)
      // if (nextSurah > 114) { /* handle end of Quran */ }
  }
  // Update state variables before calling loadVerse
  currentSurah = nextSurah;
  currentVerse = nextVerse;
  await loadVerse(currentSurah, currentVerse, true); // Update history
};

document.getElementById("home-btn").onclick = () => {
    loadVerse(1, 1, true); // Update history
};

// Go To verse button - FIXED: Read values, call loadVerse which updates state and optionally URL
document.getElementById("goto-btn").onclick = () => {
  const s = parseInt(document.getElementById("surah-input").value);
  const v = parseInt(document.getElementById("verse-input").value);

  if (!isNaN(s) && !isNaN(v) && s > 0 && v > 0) { // Validate positive numbers
    // Calling loadVerse with 'true' will load the data, update currentSurah/currentVerse,
    // and then call updateUrl() to change the address bar
    loadVerse(s, v, true); // This should update content AND URL
  } else {
    alert("Please enter valid positive Surah and Verse numbers.");
  }
};

// Load from URL if available on initial page load
const urlParams = new URLSearchParams(window.location.search);
const surahParam = parseInt(urlParams.get("surah"));
const verseParam = parseInt(urlParams.get("verse"));
if (!isNaN(surahParam) && !isNaN(verseParam)) {
  // Load the initial verse from URL params.
  // Using 'true' here ensures the loaded state is the initial history entry.
  loadVerse(surahParam, verseParam, true); // Update history on initial load if params exist
} else {
  loadVerse(1, 1, true); // Update history for default load
}
</script>

</body>
</html>
